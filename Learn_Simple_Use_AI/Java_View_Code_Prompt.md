重构代码 阅读顺序 = 执行顺序：从上往下看，就是请求的处理流程


```struct
public class 用户服务 {
    
    // ----- 1. 内部类/接口 -----
    public interface 用户回调 {
        void 处理完成(用户 用户);
    }
    
    public static class 用户 {
        String 姓名;
        int 年龄;
    }
    
    // ----- 2. 成员变量 -----
    private static final String 数据库_URL = "jdbc:mysql://localhost:3306/users";
    private static int 连接池大小 = 10;
    
    private 数据库连接 连接;
    protected 缓存管理器 缓存;
    public 日志记录器 日志;
    
    // ----- 3. 构造函数 -----
    public 用户服务() {
        this.连接 = 创建连接();
    }
    
    public 用户服务(String 连接字符串) {
        this.连接 = 创建连接(连接字符串);
    }
    
    // ----- 4. 所有方法（统一按调用链倒序排列，从底层到高层）-----
    
    /**
     * ========== 第1层：底层方法（基础功能）==========
     * 最先定义 - 被上层方法调用
     */
    
    /** 底层方法1 - 执行SQL查询 */
    private ResultSet 执行SQL查询(String sql) {
        // 基础数据库查询
        return 连接.执行查询(sql);
    }
    
    /** 底层方法2 - 转换结果为用户对象 */
    private 用户 转换结果为用户(ResultSet rs) {
        用户 用户 = new 用户();
        用户.姓名 = rs.getString("姓名");
        用户.年龄 = rs.getInt("年龄");
        return 用户;
    }
    
    /** 底层方法3 - 验证用户数据 */
    private boolean 验证用户数据(用户 用户) {
        return 用户.姓名 != null && !用户.姓名.isEmpty();
    }
    
    /**
     * ========== 第2层：中层方法（组合底层方法）==========
     * 调用底层方法，被更高层方法调用
     */
    
    /** 中层方法1 - 根据ID查询用户 */
    private 用户 根据ID查询用户(String id) {
        String sql = "SELECT * FROM users WHERE id = " + id;
        ResultSet rs = 执行SQL查询(sql);  // 调用底层方法1
        return 转换结果为用户(rs);         // 调用底层方法2
    }
    
    /** 中层方法2 - 缓存用户 */
    private void 缓存用户(用户 用户) {
        缓存.放入(用户.姓名, 用户);
    }
    
    /** 中层方法3 - 记录操作日志 */
    private void 记录日志(String 操作, 用户 用户) {
        日志.记录(操作 + ": " + 用户.姓名);
    }
    
    /**
     * ========== 第3层：高层方法（组合中层方法）==========
     * 调用中层方法，被入口方法调用
     */
    
    /** 高层方法1 - 获取并处理用户 */
    private 用户 获取并处理用户(String id) {
        用户 用户 = 根据ID查询用户(id);     // 调用中层方法1
        if (验证用户数据(用户)) {            // 调用底层方法3
            缓存用户(用户);                  // 调用中层方法2
        }
        return 用户;
    }
    
    /** 高层方法2 - 处理用户完成后回调 */
    private void 处理完成回调(用户 用户, 用户回调 回调) {
        记录日志("处理完成", 用户);          // 调用中层方法3
        if (回调 != null) {
            回调.处理完成(用户);
        }
    }
    
    /**
     * ========== 第4层：入口方法（类的公开接口）==========
     * 最后定义 - 调用高层方法，类的入口点
     */
    
    /** 入口方法1 - 查询用户（公开API） */
    public 用户 查询用户(String id) {
        return 获取并处理用户(id);           // 调用高层方法1
    }
    
    /** 入口方法2 - 查询用户并回调（公开API） */
    public void 查询用户并回调(String id, 用户回调 回调) {
        用户 用户 = 获取并处理用户(id);       // 调用高层方法1
        处理完成回调(用户, 回调);            // 调用高层方法2
    }
}


```
方法顺序，按照调用链顺序的倒序排列